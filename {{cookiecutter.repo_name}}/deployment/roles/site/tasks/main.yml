---
- name: clone project to /tmp
  git: repo={{ repo_url }} dest={{ temp_dir }}
  when: ENV != "development"

- name: install pip requirements
  pip: requirements={{ pip_requirements_file }}
       virtualenv={{ project_venv_path }}
  sudo: yes

- name: create 'log' and 'run' dirs
  file: path={{ item }} state=directory owner={{ app_user }}
  with_items:
    - "{{ project_log_path }}"
    - "{{ project_run_path }}"
  sudo: yes

- name: sync project files to location
  synchronize: src={{ repo_name }} dest={{ repo_root }}
  when: ENV != "development"

- name: run syncdb, migrate and collectstatic commands
  django_manage: command={{ item }} app_path={{ repo_root }}
                 settings={{ django_settings_file }}
                 pythonpath={{ repo_root }}
                 virtualenv={{ project_venv_path }}
  with_items:
    - syncdb
    - migrate
    - collectstatic
  sudo: yes
  sudo_user: "{{ app_user }}"
